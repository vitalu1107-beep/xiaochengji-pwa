<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å°æˆå°± Â· Small Wins</title>

  <!-- âœ… PWA -->
  <link rel="manifest" href="/xiaochengji-pwa/manifest.json" />
  <meta name="theme-color" content="#4CAF50" />

  <link rel="stylesheet" href="/xiaochengji-pwa/style.css" />
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <div class="logo">ğŸ¯</div>
        <div>
          <div class="title">å°æˆå°± <span class="en">Small Wins</span></div>
          <div class="subtitle">è®°å½•æ¯å¤©çš„å°å°è¿›æ­¥ã€‚</div>
        </div>
      </div>

      <nav class="tabs">
        <button class="tab active" data-page="home" type="button">é¦–é¡µ</button>
        <button class="tab" data-page="today" type="button">è®°å½•å¾®å…‰</button>
        <button class="tab" data-page="wall" type="button">æˆå°±å¢™</button>
        <button class="tab" id="randomBtn" type="button">éšæœºå›é¡¾</button>
        <button class="tab" data-page="settings" type="button">è®¾ç½®</button>
      </nav>
    </header>

    <!-- HOME -->
    <main class="container">
      <section id="page-home" class="page">
        <!-- é¡¶éƒ¨ï¼šé—®å€™ + æ—¥æœŸ -->
        <div class="card">
          <div class="section-head">
            <div>
              <div class="muted small" id="homeDate">2026å¹´2æœˆ11æ—¥</div>
              <div class="card-title" id="homeGreeting">ä½ å¥½ï¼Œæœ‹å‹</div>
            </div>
          </div>
        </div>

        <!-- ä»Šæ—¥èƒ½é‡ï¼šä¸€å¥è¯ -->
        <div class="card">
          <div class="muted small">ä»Šæ—¥èƒ½é‡</div>
          <div class="quote" id="homeQuote">
            â€œå“ªæ€•åªæ˜¯æŠŠç¢—æ´—äº†ï¼Œä¹Ÿæ˜¯å¯¹ç”Ÿæ´»çš„ä¸€æ¬¡æ¸©æŸ”é‡å¡‘ã€‚â€
          </div>
        </div>

        <!-- ä¸¤å¼ å…¥å£å¡ï¼šç»Ÿè®¡/å…¥å£ -->
        <div class="grid">
          <div class="card">
            <div class="card-title">ğŸ† æˆå°±è®°å½•</div>
            <div class="big" id="statStreak">0</div>
            <div class="muted">å·²åšæŒ å¤©</div>
            <button class="ghost" id="goTodayBtn" type="button">å»è®°å½•</button>
          </div>

          <div class="card">
            <div class="card-title">ğŸ’— å°ç¡®å¹¸å¢™</div>
            <div class="big" id="statAll">0</div>
            <div class="muted">ä¸ªç¬é—´</div>
            <button class="ghost" id="goWallBtn" type="button">å»çœ‹çœ‹</button>
          </div>
        </div>

        <!-- æœ€è¿‘çš„å°å¿«ä¹ -->
        <div class="card">
          <div class="section-head">
            <div class="card-title">æœ€è¿‘çš„å°å¿«ä¹</div>
          </div>

          <ul id="recentList" class="list"></ul>
          <div id="recentEmpty" class="empty hidden">è¿˜æ²¡æœ‰è®°å½•ï½å…ˆå†™ä¸‹ç¬¬ä¸€ä¸ªå°å°è¿›æ­¥å§ âœ¨</div>
        </div>
      </section>

      <!-- TODAY -->
      <section id="page-today" class="page hidden">
        <div class="card">
          <div class="card-title">âœ¨ è®°å½•å¾®å…‰</div>

          <div class="input-box">
            <textarea id="achievementInput"
              rows="2"
              placeholder="ä»Šå¤©ä½ åšäº†å“ªä»¶å¾®å°çš„äº‹ï¼Ÿ"
              autocomplete="off"></textarea>
            <button id="addBtn" type="button">å°å­˜è¿™ä¸€åˆ»</button>
          </div>

          <div class="mood-row">
            <button class="mood" type="button" data-mood="å¹³é™">ğŸŒ™ å¹³é™</button>
            <button class="mood" type="button" data-mood="æ„‰æ‚¦">âœ¨ æ„‰æ‚¦</button>
            <button class="mood" type="button" data-mood="é‡Šç„¶">ğŸŒ± é‡Šç„¶</button>
            <button class="mood" type="button" data-mood="æ…µæ‡’">â˜ï¸ æ…µæ‡’</button>
          </div>
        </div>

        <div class="card">
          <div class="section-head">
            <div class="card-title">ğŸ“… ä»Šå¤©</div>
            <button id="clearTodayBtn" class="danger ghost" type="button">æ¸…ç©ºä»Šå¤©</button>
          </div>

          <ul id="todayList" class="list"></ul>
          <div id="todayEmpty" class="empty hidden">ä»Šå¤©è¿˜æ²¡æœ‰è®°å½•ï½</div>
        </div>

        <!-- å…¼å®¹å ä½ï¼ˆä¸æ˜¾ç¤ºä¹Ÿæ— æ‰€è°“ï¼‰ -->
        <ul id="yesterdayList" class="list hidden"></ul>
        <div id="yesterdayEmpty" class="empty hidden"></div>
        <div id="historyWrap" class="hidden"></div>
        <div id="historyEmpty" class="empty hidden"></div>
      </section>

      <!-- WALL -->
      <section id="page-wall" class="page hidden">
        <div class="card">
          <div class="section-head">
            <div class="card-title">ğŸ§± æˆå°±å¢™ï¼ˆå…¨è§ˆ + æœç´¢ï¼‰</div>
          </div>

          <div class="chips" id="wallChips">
            <button class="chip" type="button" data-chip="è¿åŠ¨">è¿åŠ¨</button>
            <button class="chip" type="button" data-chip="é˜…è¯»">é˜…è¯»</button>
            <button class="chip" type="button" data-chip="å¤ç›˜">å¤ç›˜</button>
            <button class="chip" type="button" data-chip="å­¦ä¹ ">å­¦ä¹ </button>
            <button class="chip" type="button" data-chip="å·¥ä½œ">å·¥ä½œ</button>
            <button class="chip" type="button" data-chip="ç”Ÿæ´»">ç”Ÿæ´»</button>
          </div>

          <div class="input-box">
            <input id="wallSearch" type="text" placeholder="æœç´¢ï¼šæ¯”å¦‚ è¿åŠ¨ / é˜…è¯» / å¤ç›˜â€¦" autocomplete="off" />
            <button id="clearWall" class="ghost" type="button">æ¸…ç©º</button>
          </div>

          <div class="muted small" id="searchMeta"></div>
          <ul id="wallList" class="list"></ul>
          <div id="wallEmpty" class="empty hidden">æ²¡æœ‰åŒ¹é…ç»“æœã€‚</div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="page-settings" class="page hidden">
        <div class="card">
          <div class="card-title">âš™ï¸ è®¾ç½®</div>
          <p class="muted small">
            è¿™æ˜¯ä¸€ä¸ªç¦»çº¿å‹å¥½çš„ PWA åŸå‹ã€‚æ•°æ®ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ï¼ˆlocalStorageï¼‰ï¼Œä¸ä¼šä¸Šä¼ æœåŠ¡å™¨ã€‚
          </p>

          <!-- âœ… å®‰è£…æŒ‰é’®ï¼ˆAndroid Chrome å¯ç›´æ¥å¼¹å®‰è£…ï¼‰ -->
          <button id="installBtn" class="ghost" type="button">å®‰è£…åˆ°æ‰‹æœºï¼ˆæ·»åŠ åˆ°æ¡Œé¢ï¼‰</button>
          <div class="muted small" id="installHint" style="margin-top:8px;"></div>

          <div style="height:10px;"></div>

          <button id="exportBtn" class="ghost" type="button">å¯¼å‡ºä¸ºæ–‡æœ¬ï¼ˆå¤åˆ¶ï¼‰</button>
          <button id="resetAllBtn" class="danger" type="button">æ¸…ç©ºå…¨éƒ¨æ•°æ®</button>
        </div>
      </section>
    </main>

    <!-- Modal: Random Review -->
    <div id="modal" class="modal hidden">
      <div class="modal-mask" id="modalMask"></div>
      <div class="modal-card">
        <div class="modal-title">ğŸ² éšæœºå›é¡¾</div>
        <div id="modalContent" class="modal-content"></div>
        <div class="modal-actions">
          <button id="modalAgainBtn" class="ghost" type="button">å†æ¥ä¸€æ¡</button>
          <button id="modalCloseBtn" type="button">å…³é—­</button>
        </div>
      </div>
    </div>

    <div id="toast" class="toast hidden">å·²è®°å½• âœ…</div>
  </div>

  <!-- âœ… ä½ çš„ä¸šåŠ¡ JSï¼ˆç”¨ç»å¯¹è·¯å¾„æ›´ç¨³ï¼‰ -->
  <script src="/xiaochengji-pwa/main.js"></script>

  <!-- âœ… PWA install detection + SW register -->
  <script>
    // --- Service Worker ---
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/xiaochengji-pwa/sw.js").catch(console.warn);
      });
    }

    // --- Install prompt (Android/Chrome/Edge) ---
    let deferredPrompt = null;

    const installBtn = document.getElementById("installBtn");
    const installHint = document.getElementById("installHint");

    function isIOS() {
      return /iphone|ipad|ipod/i.test(window.navigator.userAgent);
    }
    function isStandalone() {
      return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
    }

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;

      if (installHint) installHint.textContent = "âœ… å¯å®‰è£…ï¼šç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å³å¯æ·»åŠ åˆ°æ¡Œé¢ã€‚";
      if (installBtn) installBtn.disabled = false;
    });

    window.addEventListener("appinstalled", () => {
      deferredPrompt = null;
      if (installHint) installHint.textContent = "ğŸ‰ å·²å®‰è£…åˆ°æ¡Œé¢ï¼";
      if (installBtn) installBtn.disabled = true;
    });

    async function installPWA() {
      // å·²ç»æ˜¯ç‹¬ç«‹æ¨¡å¼å°±ä¸ç”¨è£…
      if (isStandalone()) {
        if (installHint) installHint.textContent = "å·²åœ¨æ¡Œé¢åº”ç”¨æ¨¡å¼è¿è¡Œ âœ…";
        return;
      }

      // iOS æŒ‡å¼•
      if (isIOS()) {
        if (installHint) {
          installHint.textContent = "iPhoneï¼šè¯·ç”¨ Safari æ‰“å¼€ â†’ åˆ†äº« â†’ æ·»åŠ åˆ°ä¸»å±å¹•ã€‚";
        } else {
          alert("iPhoneï¼šè¯·ç”¨ Safari æ‰“å¼€ â†’ åˆ†äº« â†’ æ·»åŠ åˆ°ä¸»å±å¹•ã€‚");
        }
        return;
      }

      // Android/Chrome prompt
      if (!deferredPrompt) {
        if (installHint) {
          installHint.textContent = "æš‚æ—¶æ²¡æœ‰å¼¹å‡ºå®‰è£…æç¤ºï¼šè¯·å¤šæ‰“å¼€å‡ æ¬¡ï¼Œæˆ–ç”¨ Chrome/Edge è®¿é—®åå†è¯•ã€‚";
        } else {
          alert("æš‚æ—¶æ²¡æœ‰å¼¹å‡ºå®‰è£…æç¤ºï¼šè¯·å¤šæ‰“å¼€å‡ æ¬¡ï¼Œæˆ–ç”¨ Chrome/Edge è®¿é—®åå†è¯•ã€‚");
        }
        return;
      }

      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    }

    if (installBtn) {
      installBtn.addEventListener("click", installPWA);
      // é»˜è®¤æç¤º
      if (installHint) {
        if (isStandalone()) installHint.textContent = "å·²åœ¨æ¡Œé¢åº”ç”¨æ¨¡å¼è¿è¡Œ âœ…";
        else if (isIOS()) installHint.textContent = "iPhoneï¼šSafari â†’ åˆ†äº« â†’ æ·»åŠ åˆ°ä¸»å±å¹•ã€‚";
        else installHint.textContent = "Androidï¼šå¦‚æœå¯å®‰è£…ï¼Œä¼šå‡ºç°æç¤ºï¼›ä¹Ÿå¯ç‚¹æŒ‰é’®å°è¯•ã€‚";
      }
    }
  </script>
</body>
</html>
